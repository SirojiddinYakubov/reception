{% extends "base_horizontal.html" %}
{% load static i18n %}

{% block meta %}
    <title>{% trans 'Avtotransport vositalarini texnik ko\'rikdan o\'tkazish hududlari ro\'yhati' %} | E-RIB.UZ</title>
    <meta name="title"
          content="{% trans 'Avtotransport vositalarini texnik ko\'rikdan o\'tkazish hududlari ro\'yhati' %} | E-RIB.UZ">
    <meta name="description"
          content="Avtotransport vositalarini texnik ko'rikdan o'tkazish hududlari ro'yhati">
    <meta name="keywords"
          content="texpasport, tex-pasport, avtomobilni ro'yhatga olish narxi, avtotransport, avtomobil, davlat boji, ro'yhatga olish, avtomobilni ro'yhatga olish, yhxb, buxoro obl gai, fayzobod gai, tex pasport narxi, auksion nomer narxi, ">
{% endblock meta %}

{% block css %}
    <link rel="stylesheet" href="{% static 'assets/libs/bootstrap-datepicker/css/bootstrap-datepicker3.min.css' %}">
    <link href="{% static 'assets/libs/fontawesome-free/css/all.min.css' %}" rel="stylesheet" type="text/css"/>
{% endblock css %}

{% block page_title %}
    {% trans "Texnik ko'rikdan o'tkazish joylari ro'yhati" %}
{% endblock page_title %}
{% block content %}
    <div id="app">
        <div class="container">
            <div class="row bg-auto" style="background:#fff; padding:20px;">
                <h2 class="text-center pb-2"
                    style="font-weight: bold">{% trans 'Avtotransport vositalarini texnik ko\'rikdan o\'tkazish hududlari ro\'yhati' %} </h2>
                <form action="#" id="calculation_form" method="post">
                    <div class="row mb-3">
                        <label class="not_copy col-4 col-xl-3 col-form-label text-start"
                               for="region">{% trans "Viloyat" %}<span
                                class="text-danger">*</span></label>
                        <div class="col-8 col-xl-9 region">
                            <select name="region" class="form-control" id="region" v-model="region"
                                    required>

                                <option value="" disabled>{% trans '--Viloyatni tanlang--' %}</option>
                                <option :value="region.id" v-for="region in regions" :key="region.id">
                                    [[region.title]]
                                </option>
                            </select>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label class="not_copy col-4 col-xl-3 col-form-label text-start"
                               for="district">{% trans "Tuman/Shahar" %}<span
                                class="text-danger">*</span></label>
                        <div class="col-8 col-xl-9 district">
                            <select name="district" class="form-select select2" id="district" v-model="district"
                                    required>
                                <option value="" disabled>{% trans '--Tumanni tanlang--' %}</option>
                                <option :value="district.id" v-for="district in districts" :key="district.id">
                                    [[district.title]]
                                </option>
                            </select>
                        </div>
                    </div>
                    <div class="card card-body text-xs-center bg-light" v-for="diagnostic in diagnostics"
                         :key="diagnostic">
                        <h5 class="card-title"><strong>Nomi:</strong> [[diagnostic.title]]</h5>
                        <p class="card-text"><strong>Manzili:</strong> [[diagnostic.address]]</p>
                        <p class="card-text">
                            <small class="text-muted"><strong>Tel raqam:</strong> <a
                                    :href="[[ 'tel:+998' + diagnostic.phone]]">[[diagnostic.phone]]</a></small>
                        </p>
                    </div>

                    <br>
                </form>

            </div>
            <br>
        </div>
    </div>


{% endblock content %}

{% block js %}
    <script src="https://unpkg.com/vue@next"></script>
    <script src="{% static 'assets/libs/axios/axios.min.js' %}"></script>
    <script>
        const App = {
            delimiters: ['[[', ']]'],
            data() {
                return {
                    regions: [],
                    region: '',
                    districts: [],
                    district: '',
                    diagnostics: [],
                    diagnostic: ''
                }
            },
            created() {
                this.getRegions()
            },
            methods: {
                async getDiagnostics(id) {
                    await axios.get('{% url "api_partners:district_diagnostics_list" 12345 %}'.replace(/12345/, id.toString()))
                        .then(res => {
                            this.diagnostics = res.data
                        })
                        .catch(err => {
                            console.log(err)
                        })
                },
                async getRegions() {
                    await axios.get("{% url 'api_user:regions_list' %}")
                        .then(res => {
                            this.regions = res.data
                        })
                        .catch(err => {
                            console.log(err)
                        })
                },

                async getDistricts(id) {
                    await axios.get("{% url 'api_user:region_districts_list' 12345 %}".replace(/12345/, id.toString()))
                        .then(res => {
                            this.districts = res.data
                        })
                        .catch(err => {
                            console.log(err)
                        })
                }
            },
            watch: {
                region(newVal) {
                    this.getDistricts(newVal)
                },
                district(newVal) {
                    this.getDiagnostics(newVal)
                }
            }
        }

        Vue.createApp(App).mount('#app')
    </script>

{% endblock js %}
