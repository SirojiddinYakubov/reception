{% extends 'base_vertical.html' %}
{% load static %}
{% load i18n %}
{% load humanize %}
{% load applications_tags %}
{% block css %}
    <style>
        .table-striped > tbody > tr:nth-of-type(odd) {
            --bs-table-accent-bg: #e9eef1;
            color: var(--bs-table-striped-color);
        }
    </style>
{% endblock css %}

{% block page_title %}
    {% trans 'Amalllar xronologiyasi' %}
{% endblock page_title %}

{% block content %}

    <div class="row">
        {% include '_parts/messages.html' %}
        <div class="col-12 info_area">
            <div class="accordion" id="accordionPanelsStayOpenExample">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="panelsStayOpen-headingOne">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="true"
                                aria-controls="panelsStayOpen-collapseOne">
                            <h5>Ariza haqida ma'lumot</h5>
                        </button>
                    </h2>
                    <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse show"
                         aria-labelledby="panelsStayOpen-headingOne">
                        <div class="accordion-body">
                            {% include 'application/inc/about_application_part.html' %}
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="panelsStayOpen-headingTwo">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#panelsStayOpen-collapseTwo" aria-expanded="false"
                                aria-controls="panelsStayOpen-collapseTwo">
                            <h5>Ariza topshiruvchi</h5>
                        </button>
                    </h2>
                    <div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse"
                         aria-labelledby="panelsStayOpen-headingTwo">
                        <div class="accordion-body">
                            {% include 'application/inc/application_submitting_part.html' %}
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="panelsStayOpen-headingThree">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#panelsStayOpen-collapseThree" aria-expanded="false"
                                aria-controls="panelsStayOpen-collapseThree">
                            <h5>Avtomobil</h5>
                        </button>
                    </h2>
                    <div id="panelsStayOpen-collapseThree" class="accordion-collapse collapse"
                         aria-labelledby="panelsStayOpen-headingThree">
                        <div class="accordion-body">
                            {% include 'application/inc/application_car_part.html' %}
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="panelsStayOpen-headingFour">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#panelsStayOpen-collapseFour" aria-expanded="true"
                                aria-controls="panelsStayOpen-collapseFour">
                            <h5>Mavjud fayllar</h5>
                        </button>
                    </h2>
                    <div id="panelsStayOpen-collapseFour" class="accordion-collapse collapse"
                         aria-labelledby="panelsStayOpen-headingFour">
                        <div class="accordion-body">
                            <ul>
                                {% include 'application/inc/application_files_part.html' %}
                            </ul>
                        </div>
                    </div>

                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="panelsStayOpen-headingFifth">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#panelsStayOpen-collapseFifth" aria-expanded="true"
                                aria-controls="panelsStayOpen-collapseFifth">
                            <h5>To'lov</h5>
                        </button>
                    </h2>
                    <div id="panelsStayOpen-collapseFifth" class="accordion-collapse collapse"
                         aria-labelledby="panelsStayOpen-headingFifth">
                        <div class="accordion-body">
                            <ul>
                                {% include 'application/inc/application_payments_part.html' %}
                            </ul>
                        </div>
                    </div>

                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="panelsStayOpen-headingSix">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#panelsStayOpen-collapseSix" aria-expanded="true"
                                aria-controls="panelsStayOpen-collapseSix">
                            <h5>Ariza holati</h5>
                        </button>
                    </h2>
                    <div id="panelsStayOpen-collapseSix" class="accordion-collapse collapse"
                         aria-labelledby="panelsStayOpen-headingSix">
                        <div class="accordion-body">
                            <ul>
                                {% include 'application/inc/application_status_part.html' %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


{% endblock content %}
{% block js %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.8.1/html2pdf.bundle.min.js" integrity="sha512-vDKWohFHe2vkVWXHp3tKvIxxXg0pJxeid5eo+UjdjME3DBFBn2F8yWOE0XmiFcFbXxrEOR1JriWEno5Ckpn15A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="{% static 'js/main.js' %}"></script>
    <script type="text/javascript">

        $('.application_render_pdf').on('click', function () {
            var applicationId = $(this).data('application')
            window.location.href = "{% url 'application:application_pdf' id=12345 %}".replace(/12345/, applicationId.toString());
        })

        $('#payment_render_pdf').on('click', function () {
            var element = document.getElementById('render_div'),
                filename = `To'lov`

            html_to_pdf(element, filename)
        })
        calc_total()

        function calc_total() {
            if (!String.prototype.trim) {
                String.prototype.trim = function () {
                    return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g, '');
                };
            }

            var sum = 0;
            $(".state_payment").each(function () {
                sum += parseFloat($(this).text().replace(/[\s+,.]/g, ''));
            });
            $('#total_state_payments').text(sum.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " "))
        }

        var token = getCookie('token'),
            csrftoken = getCookie('csrftoken')

        $.ajaxSetup({
            beforeSend: function (xhr) {
                xhr.setRequestHeader('X-CSRFToken', csrftoken)
                xhr.setRequestHeader('Authorization', `Token ${token}`)
            },
            error: function (response) {
                if (response.status === 401) {
                    tokenInvalid()
                }
            }
        })

        $('.payment_checkbox').on('change', function () {
            let modify
            if ($(this).prop('checked')) {
                modify = true
            } else {
                modify = false
            }

            $.ajax({
                type: 'POST',
                url: '{% url "application:modify_payment_checkbox" %}',
                data: {
                    'modify': modify,
                    'payment': $(this).data('payment'),
                },
                success: function (res) {
                    if (res === 'True') {
                        edit_toast()
                    } else {
                        errorFunction()
                    }
                },
                error: function (err) {
                    errorFunction()
                }
            })
        })

    </script>
{% endblock js %}
